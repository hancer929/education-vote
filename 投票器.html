<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>分组投票系统（自动识别身份）</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, select, button { padding: 8px; margin: 5px 0; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: center; }
  </style>
</head>
<body>
  <h2>十组投票系统（自动识别身份）</h2>

  <label>请输入您的姓名与身份（格式如：张三-组员）：</label><br>
  <input type="text" id="voterInput" placeholder="如：张三-组员">
  <button onclick="authenticate()">进入投票</button>

  <div id="voteSection" style="display:none">
    <p>请选择您想投票的组：</p>
    <select id="groupSelect"></select>
    <button onclick="submitVote()">提交投票</button>
  </div>

  <div id="resultSection" style="display:none">
    <h3>投票结果：</h3>
    <table id="resultTable">
      <tr><th>组别</th><th>票数</th></tr>
    </table>
  </div>

  <script>
    const groups = ["第一组", "第二组", "第三组", "第四组", "第五组", "第六组", "第七组", "第八组", "第九组", "第十组"];
    const votes = Array(groups.length).fill(0);

    let currentRole = "";
    let currentName = "";
    let hasVoted = false;

    function authenticate() {
      const input = document.getElementById("voterInput").value.trim();
      if (!input.includes("-")) {
        alert("请输入正确格式，如：张三-组员");
        return;
      }
      const [name, role] = input.split("-");
      currentName = name.trim();
      currentRole = role.trim();

      if (currentRole === "教师") {
        showResults();
        return;
      }

      if (currentRole !== "组员" && currentRole !== "组长") {
        alert("身份必须是组员、组长或教师。");
        return;
      }

      if (hasVoted) {
        alert("您已经投过票了。");
        return;
      }

      document.getElementById('voteSection').style.display = 'block';
      const groupSelect = document.getElementById('groupSelect');
      groupSelect.innerHTML = groups.map((g, i) => `<option value="${i}">${g}</option>`).join('');
    }

    function submitVote() {
      const index = parseInt(document.getElementById('groupSelect').value);
      const weight = currentRole === "组长" ? 2 : 1;
      votes[index] += weight;
      alert(`${currentName}（${currentRole}）投票成功，记 ${weight} 票！`);
      hasVoted = true;
      document.getElementById('voteSection').style.display = 'none';
    }

    function showResults() {
      const table = document.getElementById('resultTable');
      table.innerHTML = '<tr><th>组别</th><th>票数</th></tr>';
      for (let i = 0; i < groups.length; i++) {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${groups[i]}</td><td>${votes[i]}</td>`;
        table.appendChild(row);
      }
      document.getElementById('resultSection').style.display = 'block';
    }
  </script>
</body>
</html>
